{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"p-file-upload-5","type":"registry:block","title":"Progress file upload","description":"Progress file upload","dependencies":[],"registryDependencies":["https://reui.io/r/styles/base-vega/alert.json","https://reui.io/r/styles/base-vega/badge.json","button","progress","https://reui.io/r/styles/base-vega/use-file-upload.json"],"files":[{"path":"p-file-upload-5.tsx","type":"registry:block","content":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport {\n  formatBytes,\n  useFileUpload,\n  type FileMetadata,\n  type FileWithPreview,\n} from \"@/hooks/use-file-upload\"\nimport {\n  Alert,\n  AlertAction,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/reui/alert\"\nimport { Badge } from \"@/components/reui/badge\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { IconPlaceholder } from \"@/app/(create)/components/icon-placeholder\"\n\ninterface FileUploadItem extends FileWithPreview {\n  progress: number\n  status: \"uploading\" | \"completed\" | \"error\"\n  error?: string\n}\n\ninterface ProgressUploadProps {\n  maxFiles?: number\n  maxSize?: number\n  accept?: string\n  multiple?: boolean\n  className?: string\n  onFilesChange?: (files: FileWithPreview[]) => void\n  simulateUpload?: boolean\n}\n\nexport function Pattern({\n  maxFiles = 5,\n  maxSize = 10 * 1024 * 1024, // 10MB\n  accept = \"*\",\n  multiple = true,\n  className,\n  onFilesChange,\n  simulateUpload = true,\n}: ProgressUploadProps) {\n  // Create default images using FileMetadata type\n  const defaultImages: FileMetadata[] = [\n    {\n      id: \"default-3\",\n      name: \"image-1.png\",\n      size: 42048,\n      type: \"image/png\",\n      url: \"https://picsum.photos/1000/800?grayscale&random=10\",\n    },\n    {\n      id: \"default-4\",\n      name: \"image-2.png\",\n      size: 62807,\n      type: \"image/png\",\n      url: \"https://picsum.photos/1000/800?grayscale&random=11\",\n    },\n  ]\n\n  // Convert default images to FileUploadItem format\n  const defaultUploadFiles: FileUploadItem[] = defaultImages.map((image) => ({\n    id: image.id,\n    file: {\n      name: image.name,\n      size: image.size,\n      type: image.type,\n    } as File,\n    preview: image.url,\n    progress: 100,\n    status: \"completed\" as const,\n  }))\n\n  const [uploadFiles, setUploadFiles] =\n    useState<FileUploadItem[]>(defaultUploadFiles)\n\n  const [\n    { isDragging, errors },\n    {\n      removeFile,\n      clearFiles,\n      handleDragEnter,\n      handleDragLeave,\n      handleDragOver,\n      handleDrop,\n      openFileDialog,\n      getInputProps,\n    },\n  ] = useFileUpload({\n    maxFiles,\n    maxSize,\n    accept,\n    multiple,\n    initialFiles: defaultImages,\n    onFilesChange: (newFiles) => {\n      // Convert to upload items when files change, preserving existing status\n      const newUploadFiles = newFiles.map((file) => {\n        // Check if this file already exists in uploadFiles\n        const existingFile = uploadFiles.find(\n          (existing) => existing.id === file.id\n        )\n\n        if (existingFile) {\n          // Preserve existing file status and progress\n          return {\n            ...existingFile,\n            ...file, // Update any changed properties from the file\n          }\n        } else {\n          // New file - set to uploading\n          return {\n            ...file,\n            progress: 0,\n            status: \"uploading\" as const,\n          }\n        }\n      })\n      setUploadFiles(newUploadFiles)\n      onFilesChange?.(newFiles)\n    },\n  })\n\n  // Simulate upload progress\n  useEffect(() => {\n    if (!simulateUpload) return\n\n    const interval = setInterval(() => {\n      setUploadFiles((prev) =>\n        prev.map((file) => {\n          if (file.status !== \"uploading\") return file\n\n          const increment = Math.random() * 15 + 5 // 5-20% increment\n          const newProgress = Math.min(file.progress + increment, 100)\n\n          // Simulate occasional errors (10% chance when progress > 50%)\n          if (newProgress > 50 && Math.random() < 0.1) {\n            return {\n              ...file,\n              status: \"error\" as const,\n              error: \"Upload failed. Please try again.\",\n            }\n          }\n\n          // Complete when progress reaches 100%\n          if (newProgress >= 100) {\n            return {\n              ...file,\n              progress: 100,\n              status: \"completed\" as const,\n            }\n          }\n\n          return {\n            ...file,\n            progress: newProgress,\n          }\n        })\n      )\n    }, 500)\n\n    return () => clearInterval(interval)\n  }, [simulateUpload])\n\n  const retryUpload = (fileId: string) => {\n    setUploadFiles((prev) =>\n      prev.map((file) =>\n        file.id === fileId\n          ? {\n              ...file,\n              progress: 0,\n              status: \"uploading\" as const,\n              error: undefined,\n            }\n          : file\n      )\n    )\n  }\n\n  const removeUploadFile = (fileId: string) => {\n    setUploadFiles((prev) => prev.filter((file) => file.id !== fileId))\n    removeFile(fileId)\n  }\n\n  const getFileIcon = (file: File | FileMetadata) => {\n    const type = file instanceof File ? file.type : file.type\n    if (type.startsWith(\"image/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"ImageIcon\"\n          tabler=\"IconPhoto\"\n          hugeicons=\"ImageIcon\"\n          phosphor=\"ImageIcon\"\n          remixicon=\"RiImageLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.startsWith(\"video/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"VideoIcon\"\n          tabler=\"IconVideo\"\n          hugeicons=\"Video02Icon\"\n          phosphor=\"VideoCameraIcon\"\n          remixicon=\"RiVideoOnLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.startsWith(\"audio/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"HeadphonesIcon\"\n          tabler=\"IconHeadphones\"\n          hugeicons=\"HeadphonesIcon\"\n          phosphor=\"Headphones\"\n          remixicon=\"RiCustomerServiceLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.includes(\"pdf\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileTextIcon\"\n          tabler=\"IconFileText\"\n          hugeicons=\"File02Icon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.includes(\"word\") || type.includes(\"doc\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileTextIcon\"\n          tabler=\"IconFileText\"\n          hugeicons=\"File02Icon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.includes(\"excel\") || type.includes(\"sheet\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileSpreadsheetIcon\"\n          tabler=\"IconFileSpreadsheet\"\n          hugeicons=\"GoogleSheetIcon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-4\"\n        />\n      )\n    if (type.includes(\"zip\") || type.includes(\"rar\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileArchiveIcon\"\n          tabler=\"IconFileZip\"\n          hugeicons=\"ArchiveIcon\"\n          phosphor=\"FileArchive\"\n          remixicon=\" RiFileZipLine\"\n          className=\"size-4\"\n        />\n      )\n    return (\n      <IconPlaceholder\n        lucide=\"FileTextIcon\"\n        tabler=\"IconFileText\"\n        hugeicons=\"File02Icon\"\n        phosphor=\"FileTextIcon\"\n        remixicon=\"RiFileTextLine\"\n        className=\"size-4\"\n      />\n    )\n  }\n\n  const completedCount = uploadFiles.filter(\n    (f) => f.status === \"completed\"\n  ).length\n  const errorCount = uploadFiles.filter((f) => f.status === \"error\").length\n  const uploadingCount = uploadFiles.filter(\n    (f) => f.status === \"uploading\"\n  ).length\n\n  return (\n    <div className={cn(\"w-full max-w-2xl\", className)}>\n      {/* Upload Area */}\n      <div\n        className={cn(\n          \"rounded-lg relative border border-dashed p-8 text-center transition-colors\",\n          isDragging\n            ? \"border-primary bg-primary/5\"\n            : \"border-muted-foreground/25 hover:border-muted-foreground/50\"\n        )}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n      >\n        <input {...getInputProps()} className=\"sr-only\" />\n\n        <div className=\"flex flex-col items-center gap-4\">\n          <div\n            className={cn(\n              \"flex h-16 w-16 items-center justify-center rounded-full\",\n              isDragging ? \"bg-primary/10\" : \"bg-muted\"\n            )}\n          >\n            <IconPlaceholder\n              lucide=\"UploadIcon\"\n              tabler=\"IconUpload\"\n              hugeicons=\"Upload01Icon\"\n              phosphor=\"UploadSimple\"\n              remixicon=\"RiUpload2Line\"\n              className={cn(\n                \"h-6\",\n                isDragging ? \"text-primary\" : \"text-muted-foreground\"\n              )}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <h3 className=\"text-lg font-semibold\">Upload your files</h3>\n            <p className=\"text-muted-foreground text-sm\">\n              Drag and drop files here or click to browse\n            </p>\n            <p className=\"text-muted-foreground text-xs\">\n              Support for multiple file types up to {formatBytes(maxSize)} each\n            </p>\n          </div>\n\n          <Button onClick={openFileDialog}>\n            <IconPlaceholder\n              lucide=\"UploadIcon\"\n              tabler=\"IconUpload\"\n              hugeicons=\"Upload01Icon\"\n              phosphor=\"UploadSimple\"\n              remixicon=\"RiUpload2Line\"\n              className=\"h-4 w-4\"\n            />\n            Select files\n          </Button>\n        </div>\n      </div>\n\n      {/* Upload Stats */}\n      {uploadFiles.length > 0 && (\n        <div className=\"mt-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <h4 className=\"text-sm font-medium\">Upload Progress</h4>\n            <div className=\"flex items-center gap-2\">\n              {completedCount > 0 && (\n                <Badge size=\"sm\" variant=\"success-light\">\n                  Completed: {completedCount}\n                </Badge>\n              )}\n              {errorCount > 0 && (\n                <Badge size=\"sm\" variant=\"destructive\">\n                  Failed: {errorCount}\n                </Badge>\n              )}\n              {uploadingCount > 0 && (\n                <Badge size=\"sm\" variant=\"secondary\">\n                  Uploading: {uploadingCount}\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          <Button onClick={clearFiles} variant=\"outline\" size=\"sm\">\n            Clear all\n          </Button>\n        </div>\n      )}\n\n      {/* File List */}\n      {uploadFiles.length > 0 && (\n        <div className=\"mt-4 space-y-3\">\n          {uploadFiles.map((fileItem: FileUploadItem) => (\n            <div\n              key={fileItem.id}\n              className=\"border-border bg-card rounded-lg border p-2.5\"\n            >\n              <div className=\"flex items-start gap-2.5\">\n                {/* File Icon */}\n                <div className=\"shrink-0\">\n                  {fileItem.preview &&\n                  fileItem.file.type.startsWith(\"image/\") ? (\n                    <img\n                      src={fileItem.preview}\n                      alt={fileItem.file.name}\n                      className=\"rounded-lg h-12 w-12 border object-cover\"\n                    />\n                  ) : (\n                    <div className=\"border-border text-muted-foreground rounded-lg flex h-12 w-12 items-center justify-center border\">\n                      {getFileIcon(fileItem.file)}\n                    </div>\n                  )}\n                </div>\n\n                {/* File Info */}\n                <div className=\"min-w-0 flex-1\">\n                  <div className=\"mt-0.75 flex items-center justify-between\">\n                    <p className=\"inline-flex flex-col justify-center gap-1 truncate font-medium\">\n                      <span className=\"text-sm\">{fileItem.file.name}</span>\n                      <span className=\"text-muted-foreground text-xs\">\n                        {formatBytes(fileItem.file.size)}\n                      </span>\n                    </p>\n                    <div className=\"flex items-center gap-2\">\n                      {/* Remove Button */}\n                      <Button\n                        onClick={() => removeUploadFile(fileItem.id)}\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"text-muted-foreground size-6 hover:bg-transparent hover:opacity-100\"\n                      >\n                        <IconPlaceholder\n                          lucide=\"XIcon\"\n                          tabler=\"IconX\"\n                          hugeicons=\"MultiplicationSignIcon\"\n                          phosphor=\"XIcon\"\n                          remixicon=\"RiCloseLine\"\n                          className=\"size-4\"\n                        />\n                      </Button>\n                    </div>\n                  </div>\n\n                  {/* Progress Bar */}\n                  {fileItem.status === \"uploading\" && (\n                    <div className=\"mt-2\">\n                      <Progress value={fileItem.progress} className=\"h-1\" />\n                    </div>\n                  )}\n\n                  {/* Error Message */}\n                  {fileItem.status === \"error\" && fileItem.error && (\n                    <Alert variant=\"destructive\" className=\"mt-2 px-2 py-1\">\n                      <IconPlaceholder\n                        lucide=\"CircleAlertIcon\"\n                        tabler=\"IconAlertCircle\"\n                        hugeicons=\"AlertCircleIcon\"\n                        phosphor=\"WarningCircleIcon\"\n                        remixicon=\"RiErrorWarningLine\"\n                        className=\"size-4\"\n                      />\n                      <AlertTitle className=\"text-xs\">\n                        {fileItem.error}\n                      </AlertTitle>\n                      <AlertAction>\n                        <Button\n                          onClick={() => retryUpload(fileItem.id)}\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"text-muted-foreground size-6 hover:bg-transparent hover:opacity-100\"\n                        >\n                          <IconPlaceholder\n                            lucide=\"RefreshCwIcon\"\n                            tabler=\"IconRefreshDot\"\n                            hugeicons=\"Refresh04Icon\"\n                            phosphor=\"ArrowsClockwiseIcon\"\n                            remixicon=\"RiRestartLine\"\n                            className=\"size-3.5\"\n                          />\n                        </Button>\n                      </AlertAction>\n                    </Alert>\n                  )}\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Error Messages */}\n      {errors.length > 0 && (\n        <Alert variant=\"destructive\" className=\"mt-5\">\n          <IconPlaceholder\n            lucide=\"CircleAlertIcon\"\n            tabler=\"IconAlertCircle\"\n            hugeicons=\"AlertCircleIcon\"\n            phosphor=\"WarningCircleIcon\"\n            remixicon=\"RiErrorWarningLine\"\n          />\n          <AlertTitle>File upload error(s)</AlertTitle>\n          <AlertDescription>\n            {errors.map((error, index) => (\n              <p key={index} className=\"last:mb-0\">\n                {error}\n              </p>\n            ))}\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  )\n}","target":"components/patterns/p-file-upload-5.tsx"}]}