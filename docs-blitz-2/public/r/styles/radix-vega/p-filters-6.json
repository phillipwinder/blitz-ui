{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"p-filters-6","type":"registry:block","title":"Filters with custom controls","description":"Filters with custom controls","dependencies":["date-fns","react-day-picker"],"registryDependencies":["button","calendar","https://reui.io/r/styles/radix-vega/date-selector.json","dialog","https://reui.io/r/styles/radix-vega/filters.json","popover","scroll-area","slider"],"files":[{"path":"p-filters-6.tsx","type":"registry:block","content":"\"use client\"\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\"\nimport {\n  DateSelector,\n  formatDateValue,\n  type DateSelectorValue,\n} from \"@/components/reui/date-selector\"\nimport {\n  createFilter,\n  Filters,\n  type Filter,\n  type FilterFieldConfig,\n} from \"@/components/reui/filters\"\nimport {\n  endOfMonth,\n  endOfYear,\n  format,\n  isEqual,\n  startOfDay,\n  startOfMonth,\n  startOfYear,\n  subDays,\n  subMonths,\n  subYears,\n} from \"date-fns\"\nimport { DateRange } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport {\n  Dialog,\n  DialogClose,\n  DialogContent,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { Slider } from \"@/components/ui/slider\"\nimport { IconPlaceholder } from \"@/app/(create)/components/icon-placeholder\"\n\n// Type for custom renderer props\ntype CustomRendererProps = {\n  values: unknown[]\n  onChange: (values: unknown[]) => void\n  autoFocus?: boolean\n}\n\n// Modal-based Date Selector Component\nfunction CustomModalDateSelector({\n  values,\n  onChange,\n  autoFocus,\n}: CustomRendererProps) {\n  const value = values?.[0] as DateSelectorValue | undefined\n  const [open, setOpen] = useState(false)\n  const [internalValue, setInternalValue] = useState<\n    DateSelectorValue | undefined\n  >(value)\n\n  const formattedValue = value ? formatDateValue(value) : \"\"\n  const displayText = formattedValue || \"Select a date\"\n\n  useEffect(() => {\n    if (autoFocus) {\n      const timer = setTimeout(() => setOpen(true), 400)\n      return () => clearTimeout(timer)\n    }\n  }, [autoFocus])\n\n  useEffect(() => {\n    if (open) {\n      setInternalValue(value)\n    }\n  }, [open, value])\n\n  const handleApply = () => {\n    onChange([internalValue])\n    setOpen(false)\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger>{displayText}</DialogTrigger>\n      <DialogContent className=\"sm:max-w-lg\" showCloseButton={false}>\n        <DialogHeader>\n          <DialogTitle>Select Date</DialogTitle>\n        </DialogHeader>\n\n        <DateSelector\n          value={internalValue}\n          onChange={setInternalValue}\n          showInput={true}\n        />\n\n        <DialogFooter>\n          <DialogClose asChild>\n            <Button variant=\"outline\">Cancel</Button>\n          </DialogClose>\n          <Button onClick={handleApply}>Apply</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\n// Custom Date Range Input Component\nfunction CustomDateRangeInput({\n  values,\n  onChange,\n  autoFocus,\n}: CustomRendererProps) {\n  const [date, setDate] = useState<DateRange | undefined>(\n    values?.[0] && typeof values[0] === \"string\"\n      ? {\n          from: new Date(values[0] as string),\n          to:\n            values[1] && typeof values[1] === \"string\"\n              ? new Date(values[1] as string)\n              : undefined,\n        }\n      : undefined\n  )\n  const [isOpen, setIsOpen] = useState(false)\n\n  useEffect(() => {\n    if (autoFocus) {\n      const timer = setTimeout(() => setIsOpen(true), 400)\n      return () => clearTimeout(timer)\n    }\n  }, [autoFocus])\n\n  const handleApply = () => {\n    if (date?.from) {\n      const fromStr = date.from.toISOString().split(\"T\")[0]\n      const toStr = date.to ? date.to.toISOString().split(\"T\")[0] : fromStr\n      onChange([fromStr, toStr])\n    }\n    setIsOpen(false)\n  }\n\n  const handleCancel = () => {\n    setIsOpen(false)\n  }\n\n  const handleSelect = (selected: DateRange | undefined) => {\n    setDate(selected)\n  }\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger>\n        {date?.from ? (\n          date.to ? (\n            <>\n              {format(date.from, \"LLL dd, y\")} - {format(date.to, \"LLL dd, y\")}\n            </>\n          ) : (\n            format(date.from, \"LLL dd, y\")\n          )\n        ) : (\n          <span>Pick a date range</span>\n        )}\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\" sideOffset={8}>\n        <Calendar\n          autoFocus\n          mode=\"range\"\n          defaultMonth={date?.from}\n          showOutsideDays={false}\n          selected={date}\n          onSelect={handleSelect}\n          numberOfMonths={2}\n        />\n        <div className=\"border-border flex items-center justify-end gap-1.5 border-t p-3\">\n          <Button variant=\"outline\" onClick={handleCancel}>\n            Cancel\n          </Button>\n          <Button onClick={handleApply}>Apply</Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// Custom Date Range with Presets Input Component\nfunction CustomDateRangeWithPresetsInput({\n  values,\n  onChange,\n  autoFocus,\n}: CustomRendererProps) {\n  const today = useMemo(() => new Date(), [])\n\n  const presets = useMemo(\n    () => [\n      { label: \"Today\", range: { from: today, to: today } },\n      {\n        label: \"Yesterday\",\n        range: { from: subDays(today, 1), to: subDays(today, 1) },\n      },\n      { label: \"Last 7 days\", range: { from: subDays(today, 6), to: today } },\n      { label: \"Last 30 days\", range: { from: subDays(today, 29), to: today } },\n      {\n        label: \"Month to date\",\n        range: { from: startOfMonth(today), to: today },\n      },\n      {\n        label: \"Last month\",\n        range: {\n          from: startOfMonth(subMonths(today, 1)),\n          to: endOfMonth(subMonths(today, 1)),\n        },\n      },\n      { label: \"Year to date\", range: { from: startOfYear(today), to: today } },\n      {\n        label: \"Last year\",\n        range: {\n          from: startOfYear(subYears(today, 1)),\n          to: endOfYear(subYears(today, 1)),\n        },\n      },\n    ],\n    [today]\n  )\n\n  const [month, setMonth] = useState(today)\n  const [date, setDate] = useState<DateRange | undefined>(\n    values?.[0] && typeof values[0] === \"string\"\n      ? {\n          from: new Date(values[0] as string),\n          to:\n            values[1] && typeof values[1] === \"string\"\n              ? new Date(values[1] as string)\n              : undefined,\n        }\n      : undefined\n  )\n  const [selectedPreset, setSelectedPreset] = useState<string | null>(null)\n  const [isOpen, setIsOpen] = useState(false)\n\n  useEffect(() => {\n    if (autoFocus) {\n      const timer = setTimeout(() => setIsOpen(true), 400)\n      return () => clearTimeout(timer)\n    }\n  }, [autoFocus])\n\n  useEffect(() => {\n    const matchedPreset = presets.find(\n      (preset) =>\n        isEqual(\n          startOfDay(preset.range.from),\n          startOfDay(date?.from || new Date(0))\n        ) &&\n        isEqual(\n          startOfDay(preset.range.to),\n          startOfDay(date?.to || new Date(0))\n        )\n    )\n    setSelectedPreset(matchedPreset?.label || null)\n  }, [date, presets])\n\n  const handleApply = () => {\n    if (date?.from) {\n      const fromStr = date.from.toISOString().split(\"T\")[0]\n      const toStr = date.to ? date.to.toISOString().split(\"T\")[0] : fromStr\n      onChange([fromStr, toStr])\n    }\n    setIsOpen(false)\n  }\n\n  const handleCancel = () => {\n    setIsOpen(false)\n  }\n\n  const handleSelect = (selected: DateRange | undefined) => {\n    setDate({\n      from: selected?.from || undefined,\n      to: selected?.to || undefined,\n    })\n    setSelectedPreset(null)\n  }\n\n  const handlePresetSelect = (preset: (typeof presets)[0]) => {\n    setDate(preset.range)\n    setMonth(preset.range.from || today)\n    setSelectedPreset(preset.label)\n  }\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger>\n        {date?.from ? (\n          format(date.from, \"LLL dd, y\") +\n          (date.to ? ` - ${format(date.to, \"LLL dd, y\")}` : \"\")\n        ) : (\n          <span>Pick a date range with presets</span>\n        )}\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"center\" sideOffset={8}>\n        <div className=\"flex max-sm:flex-col\">\n          <div className=\"border-border relative max-sm:order-1 max-sm:border-t sm:w-32\">\n            <div className=\"border-border h-full py-2 sm:border-e\">\n              <div className=\"flex flex-col gap-[2px] px-2\">\n                {presets.map((preset, index) => (\n                  <Button\n                    key={index}\n                    type=\"button\"\n                    variant=\"ghost\"\n                    className={cn(\n                      \"h-8 w-full justify-start\",\n                      selectedPreset === preset.label && \"bg-accent\"\n                    )}\n                    onClick={() => handlePresetSelect(preset)}\n                  >\n                    {preset.label}\n                  </Button>\n                ))}\n              </div>\n            </div>\n          </div>\n          <Calendar\n            autoFocus\n            mode=\"range\"\n            month={month}\n            onMonthChange={setMonth}\n            showOutsideDays={false}\n            selected={date}\n            onSelect={handleSelect}\n            numberOfMonths={2}\n          />\n        </div>\n        <div className=\"border-border flex items-center justify-end gap-1.5 border-t p-3\">\n          <Button variant=\"outline\" onClick={handleCancel}>\n            Cancel\n          </Button>\n          <Button onClick={handleApply}>Apply</Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// Custom DateTime Input Component\nfunction CustomDateTimeInput({\n  values,\n  onChange,\n  autoFocus,\n}: CustomRendererProps) {\n  const today = new Date()\n  const [date, setDate] = useState<Date | undefined>(\n    values?.[0] && typeof values[0] === \"string\"\n      ? new Date(values[0] as string)\n      : undefined\n  )\n  const [time, setTime] = useState<string | undefined>(\n    values?.[0] && typeof values[0] === \"string\"\n      ? new Date(values[0] as string).toTimeString().slice(0, 5)\n      : \"10:00\"\n  )\n  const [isOpen, setIsOpen] = useState(false)\n\n  useEffect(() => {\n    if (autoFocus) {\n      const timer = setTimeout(() => setIsOpen(true), 400)\n      return () => clearTimeout(timer)\n    }\n  }, [autoFocus])\n\n  const timeSlots = [\n    { time: \"09:00\", available: false },\n    { time: \"09:30\", available: false },\n    { time: \"10:00\", available: true },\n    { time: \"10:30\", available: true },\n    { time: \"11:00\", available: true },\n    { time: \"11:30\", available: true },\n    { time: \"12:00\", available: false },\n    { time: \"12:30\", available: true },\n    { time: \"13:00\", available: true },\n    { time: \"13:30\", available: true },\n    { time: \"14:00\", available: true },\n    { time: \"14:30\", available: false },\n    { time: \"15:00\", available: false },\n    { time: \"15:30\", available: true },\n    { time: \"16:00\", available: true },\n    { time: \"16:30\", available: true },\n    { time: \"17:00\", available: true },\n    { time: \"17:30\", available: true },\n    { time: \"18:00\", available: true },\n    { time: \"18:30\", available: true },\n    { time: \"19:00\", available: true },\n    { time: \"19:30\", available: true },\n    { time: \"20:00\", available: true },\n    { time: \"20:30\", available: true },\n    { time: \"21:00\", available: true },\n    { time: \"21:30\", available: true },\n    { time: \"22:00\", available: true },\n    { time: \"22:30\", available: true },\n    { time: \"23:00\", available: true },\n    { time: \"23:30\", available: true },\n  ]\n\n  const handleApply = () => {\n    if (date && time) {\n      const dateTime = new Date(date)\n      const [hours, minutes] = time.split(\":\").map(Number)\n      dateTime.setHours(hours, minutes, 0, 0)\n      onChange([dateTime.toISOString()])\n    }\n    setIsOpen(false)\n  }\n\n  const handleCancel = () => {\n    setIsOpen(false)\n  }\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger>\n        {date ? (\n          format(date, \"PPP\") + (time ? ` - ${time}` : \"\")\n        ) : (\n          <span>Pick a date and time</span>\n        )}\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto gap-0 p-0 pt-1\" align=\"start\">\n        <div className=\"flex max-sm:flex-col\">\n          <Calendar\n            mode=\"single\"\n            selected={date}\n            onSelect={(newDate: Date | undefined) => {\n              if (newDate) {\n                setDate(newDate)\n                setTime(undefined)\n              }\n            }}\n            className=\"p-2 sm:pe-5\"\n            disabled={[{ before: today }]}\n          />\n          <div className=\"relative w-full max-sm:h-46 sm:w-40\">\n            <div className=\"absolute inset-0 py-4 max-sm:border-t\">\n              <ScrollArea className=\"h-full sm:border-s\">\n                <div className=\"space-y-3\">\n                  <div className=\"flex h-5 shrink-0 items-center px-5\">\n                    <p className=\"text-sm font-medium\">\n                      {date ? format(date, \"EEEE, d\") : \"Pick a date\"}\n                    </p>\n                  </div>\n                  <div className=\"grid gap-1.5 px-5 max-sm:grid-cols-2\">\n                    {timeSlots.map(({ time: timeSlot, available }) => (\n                      <Button\n                        key={timeSlot}\n                        variant={time === timeSlot ? \"default\" : \"outline\"}\n                        size=\"sm\"\n                        className=\"w-full\"\n                        onClick={() => setTime(timeSlot)}\n                        disabled={!available}\n                      >\n                        {timeSlot}\n                      </Button>\n                    ))}\n                  </div>\n                </div>\n              </ScrollArea>\n            </div>\n          </div>\n        </div>\n        <div className=\"border-border flex items-center justify-end gap-1.5 border-t p-3\">\n          <Button variant=\"outline\" onClick={handleCancel}>\n            Cancel\n          </Button>\n          <Button onClick={handleApply}>Apply</Button>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\n// Custom Slider Range Input Component\nfunction CustomSliderRangeInput({\n  values,\n  onChange,\n  autoFocus,\n}: CustomRendererProps) {\n  const [range, setRange] = useState<number[]>(\n    values?.[0] &&\n      typeof values[0] === \"object\" &&\n      values[0] !== null &&\n      \"min\" in values[0] &&\n      \"max\" in values[0]\n      ? [\n          (values[0] as { min: number; max: number }).min,\n          (values[0] as { min: number; max: number }).max,\n        ]\n      : [0, 100]\n  )\n  const [isOpen, setIsOpen] = useState(false)\n\n  useEffect(() => {\n    if (autoFocus) {\n      const timer = setTimeout(() => setIsOpen(true), 400)\n      return () => clearTimeout(timer)\n    }\n  }, [autoFocus])\n\n  const handleApply = () => {\n    onChange([{ min: range[0], max: range[1] }])\n    setIsOpen(false)\n  }\n\n  const handleCancel = () => {\n    setIsOpen(false)\n  }\n\n  return (\n    <Popover open={isOpen} onOpenChange={setIsOpen}>\n      <PopoverTrigger asChild>\n        <span>\n          {range[0]} - {range[1]}\n        </span>\n      </PopoverTrigger>\n      <PopoverContent\n        className=\"w-auto p-4\"\n        align=\"start\"\n        sideOffset={8}\n        alignOffset={-8}\n      >\n        <div className=\"space-y-2.5\">\n          <div className=\"space-y-4 pt-2.5\">\n            <Slider\n              value={range}\n              onValueChange={(value) => setRange(value as number[])}\n              max={100}\n              min={0}\n              step={1}\n              className=\"w-[200px]\"\n            />\n            <div className=\"text-muted-foreground flex justify-between ps-1.5 text-xs\">\n              <span>0</span>\n              <span>100</span>\n            </div>\n          </div>\n          <div className=\"flex items-center justify-end gap-1.5\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleCancel}>\n              Cancel\n            </Button>\n            <Button size=\"sm\" variant=\"outline\" onClick={handleApply}>\n              Apply\n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\nexport function Pattern() {\n  const [filters, setFilters] = useState<Filter[]>([\n    createFilter(\"customDateRange\", \"between\", []),\n  ])\n  const [lastAddedValues, setLastAddedValues] = useState<unknown[] | null>(null)\n\n  const fields: FilterFieldConfig[] = [\n    {\n      key: \"modalDateSelector\",\n      label: \"Modal Date Selector\",\n      icon: (\n        <IconPlaceholder\n          lucide=\"CalendarIcon\"\n          tabler=\"IconCalendarEvent\"\n          hugeicons=\"Calendar04Icon\"\n          phosphor=\"CalendarBlankIcon\"\n          remixicon=\"RiCalendarLine\"\n          className=\"size-3.5\"\n        />\n      ),\n      type: \"custom\",\n      operators: [\n        { value: \"is\", label: \"is\" },\n        { value: \"is_not\", label: \"is not\" },\n      ],\n      customRenderer: ({ values, onChange }) => (\n        <CustomModalDateSelector\n          values={values}\n          onChange={onChange}\n          autoFocus={values === lastAddedValues}\n        />\n      ),\n    },\n    {\n      key: \"customDateRange\",\n      label: \"Date Range\",\n      icon: (\n        <IconPlaceholder\n          lucide=\"CalendarIcon\"\n          tabler=\"IconCalendarEvent\"\n          hugeicons=\"Calendar04Icon\"\n          phosphor=\"CalendarBlankIcon\"\n          remixicon=\"RiCalendarLine\"\n          className=\"size-3.5\"\n        />\n      ),\n      type: \"custom\",\n      operators: [\n        { value: \"between\", label: \"between\" },\n        { value: \"not_between\", label: \"not between\" },\n      ],\n      customRenderer: ({ values, onChange }) => (\n        <CustomDateRangeInput\n          values={values}\n          onChange={onChange}\n          autoFocus={values === lastAddedValues}\n        />\n      ),\n    },\n    {\n      key: \"customDateRangePresets\",\n      label: \"Date Range Presets\",\n      icon: (\n        <IconPlaceholder\n          lucide=\"CalendarIcon\"\n          tabler=\"IconCalendarEvent\"\n          hugeicons=\"Calendar04Icon\"\n          phosphor=\"CalendarBlankIcon\"\n          remixicon=\"RiCalendarLine\"\n          className=\"size-3.5\"\n        />\n      ),\n      type: \"custom\",\n      operators: [\n        { value: \"between\", label: \"between\" },\n        { value: \"not_between\", label: \"not between\" },\n      ],\n      customRenderer: ({ values, onChange }) => (\n        <CustomDateRangeWithPresetsInput\n          values={values}\n          onChange={onChange}\n          autoFocus={values === lastAddedValues}\n        />\n      ),\n    },\n    {\n      key: \"customDateTime\",\n      label: \"Date & Time\",\n      icon: (\n        <IconPlaceholder\n          lucide=\"ClockIcon\"\n          tabler=\"IconClock\"\n          hugeicons=\"ClockIcon\"\n          phosphor=\"ClockIcon\"\n          remixicon=\"RiTimeLine\"\n          className=\"size-3.5\"\n        />\n      ),\n      type: \"custom\",\n      operators: [\n        { value: \"is\", label: \"is\" },\n        { value: \"before\", label: \"before\" },\n        { value: \"after\", label: \"after\" },\n      ],\n      customRenderer: ({ values, onChange }) => (\n        <CustomDateTimeInput\n          values={values}\n          onChange={onChange}\n          autoFocus={values === lastAddedValues}\n        />\n      ),\n    },\n    {\n      key: \"customSliderRange\",\n      label: \"Slider Range\",\n      icon: (\n        <IconPlaceholder\n          lucide=\"SlidersVerticalIcon\"\n          tabler=\"IconAdjustmentsAlt\"\n          hugeicons=\"SlidersVerticalIcon\"\n          phosphor=\"FadersIcon\"\n          remixicon=\"RiSoundModuleLine\"\n          className=\"size-3.5\"\n        />\n      ),\n      type: \"custom\",\n      className: \"w-36\",\n      operators: [\n        { value: \"between\", label: \"between\" },\n        { value: \"not_between\", label: \"not between\" },\n      ],\n      customRenderer: ({ values, onChange }) => (\n        <CustomSliderRangeInput\n          values={values}\n          onChange={onChange}\n          autoFocus={values === lastAddedValues}\n        />\n      ),\n    },\n  ]\n\n  const handleFiltersChange = useCallback(\n    (newFilters: Filter[]) => {\n      // Check if a filter was added by comparing IDs\n      const added = newFilters.find(\n        (nf) => !filters.some((f) => f.id === nf.id)\n      )\n      if (added) {\n        setLastAddedValues(added.values)\n      }\n      setFilters(newFilters)\n    },\n    [filters]\n  )\n\n  return (\n    <div className=\"flex grow content-start items-start gap-2.5 space-y-6 self-start\">\n      <div className=\"flex-1\">\n        <Filters\n          filters={filters}\n          fields={fields}\n          onChange={handleFiltersChange}\n          trigger={\n            <Button variant=\"outline\" size=\"icon\">\n              <IconPlaceholder\n                lucide=\"ListFilterIcon\"\n                tabler=\"IconFilter2\"\n                hugeicons=\"FilterMailIcon\"\n                phosphor=\"FunnelSimpleIcon\"\n                remixicon=\"RiFilter3Line\"\n              />\n            </Button>\n          }\n        />\n      </div>\n\n      {filters.length > 0 && (\n        <Button variant=\"outline\" onClick={() => setFilters([])}>\n          <IconPlaceholder\n            lucide=\"FunnelXIcon\"\n            tabler=\"IconFilterX\"\n            hugeicons=\"FilterRemoveIcon\"\n            phosphor=\"FunnelXIcon\"\n            remixicon=\"RiFilterOffLine\"\n          />\n          Clear\n        </Button>\n      )}\n    </div>\n  )\n}","target":"components/patterns/p-filters-6.tsx"}]}