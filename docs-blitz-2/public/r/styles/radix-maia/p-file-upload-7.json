{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"p-file-upload-7","type":"registry:block","title":"Image upload","description":"Image upload","dependencies":[],"registryDependencies":["https://reui.io/r/styles/radix-maia/alert.json","button","card","progress"],"files":[{"path":"p-file-upload-7.tsx","type":"registry:block","content":"\"use client\"\n\nimport { useCallback, useState } from \"react\"\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/reui/alert\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport { Progress } from \"@/components/ui/progress\"\nimport { IconPlaceholder } from \"@/app/(create)/components/icon-placeholder\"\n\ninterface ImageFile {\n  id: string\n  file: File\n  preview: string\n  progress: number\n  status: \"uploading\" | \"completed\" | \"error\"\n  error?: string\n}\n\ninterface ImageUploadProps {\n  maxFiles?: number\n  maxSize?: number\n  accept?: string\n  className?: string\n  onImagesChange?: (images: ImageFile[]) => void\n  onUploadComplete?: (images: ImageFile[]) => void\n}\n\nexport function Pattern({\n  maxFiles = 10,\n  maxSize = 2 * 1024 * 1024, // 2MB\n  accept = \"image/*\",\n  className,\n  onImagesChange,\n  onUploadComplete,\n}: ImageUploadProps) {\n  const [images, setImages] = useState<ImageFile[]>([])\n  const [isDragging, setIsDragging] = useState(false)\n  const [errors, setErrors] = useState<string[]>([])\n  const [visibleDefaultImages, setVisibleDefaultImages] = useState([\n    {\n      id: \"default-1\",\n      src: \"https://picsum.photos/1000/800?grayscale&random=4\",\n      alt: \"Product view 1\",\n    },\n    {\n      id: \"default-2\",\n      src: \"https://picsum.photos/1000/800?grayscale&random=5\",\n      alt: \"Product view 2\",\n    },\n    {\n      id: \"default-3\",\n      src: \"https://picsum.photos/1000/800?grayscale&random=6\",\n      alt: \"Product view 3\",\n    },\n    {\n      id: \"default-4\",\n      src: \"https://picsum.photos/1000/800?grayscale&random=7\",\n      alt: \"Product view 4\",\n    },\n  ])\n\n  const validateFile = (file: File): string | null => {\n    if (!file.type.startsWith(\"image/\")) {\n      return \"File must be an image\"\n    }\n    if (file.size > maxSize) {\n      return `File size must be less than ${(maxSize / 1024 / 1024).toFixed(1)}MB`\n    }\n    if (images.length >= maxFiles) {\n      return `Maximum ${maxFiles} files allowed`\n    }\n    return null\n  }\n\n  const addImages = useCallback(\n    (files: FileList | File[]) => {\n      const newImages: ImageFile[] = []\n      const newErrors: string[] = []\n\n      Array.from(files).forEach((file) => {\n        const error = validateFile(file)\n        if (error) {\n          newErrors.push(`${file.name}: ${error}`)\n          return\n        }\n\n        const imageFile: ImageFile = {\n          id: `${Date.now()}-${Math.random()}`,\n          file,\n          preview: URL.createObjectURL(file),\n          progress: 0,\n          status: \"uploading\",\n        }\n\n        newImages.push(imageFile)\n      })\n\n      if (newErrors.length > 0) {\n        setErrors((prev) => [...prev, ...newErrors])\n      }\n\n      if (newImages.length > 0) {\n        const updatedImages = [...images, ...newImages]\n        setImages(updatedImages)\n        onImagesChange?.(updatedImages)\n\n        // Simulate upload progress\n        newImages.forEach((imageFile) => {\n          simulateUpload(imageFile)\n        })\n      }\n    },\n    [images, maxSize, maxFiles, onImagesChange]\n  )\n\n  const simulateUpload = (imageFile: ImageFile) => {\n    let progress = 0\n    const interval = setInterval(() => {\n      progress += Math.random() * 20\n      if (progress >= 100) {\n        progress = 100\n        clearInterval(interval)\n\n        setImages((prev) =>\n          prev.map((img) =>\n            img.id === imageFile.id\n              ? { ...img, progress: 100, status: \"completed\" as const }\n              : img\n          )\n        )\n\n        // Check if all uploads are complete\n        const updatedImages = images.map((img) =>\n          img.id === imageFile.id\n            ? { ...img, progress: 100, status: \"completed\" as const }\n            : img\n        )\n\n        if (updatedImages.every((img) => img.status === \"completed\")) {\n          onUploadComplete?.(updatedImages)\n        }\n      } else {\n        setImages((prev) =>\n          prev.map((img) =>\n            img.id === imageFile.id ? { ...img, progress } : img\n          )\n        )\n      }\n    }, 100)\n  }\n\n  const removeImage = useCallback((id: string) => {\n    // If it's a default image, remove it from visible defaults\n    if (id.startsWith(\"default-\")) {\n      setVisibleDefaultImages((prev) => prev.filter((img) => img.id !== id))\n      return\n    }\n\n    // Remove uploaded image\n    setImages((prev) => {\n      const image = prev.find((img) => img.id === id)\n      if (image) {\n        URL.revokeObjectURL(image.preview)\n      }\n      return prev.filter((img) => img.id !== id)\n    })\n  }, [])\n\n  const handleDragEnter = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragging(true)\n  }, [])\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setIsDragging(false)\n  }, [])\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n  }, [])\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault()\n      e.stopPropagation()\n      setIsDragging(false)\n\n      const files = e.dataTransfer.files\n      if (files.length > 0) {\n        addImages(files)\n      }\n    },\n    [addImages]\n  )\n\n  const openFileDialog = useCallback(() => {\n    const input = document.createElement(\"input\")\n    input.type = \"file\"\n    input.multiple = true\n    input.accept = accept\n    input.onchange = (e) => {\n      const target = e.target as HTMLInputElement\n      if (target.files) {\n        addImages(target.files)\n      }\n    }\n    input.click()\n  }, [accept, addImages])\n\n  const formatBytes = (bytes: number): string => {\n    if (bytes === 0) return \"0 Bytes\"\n    const k = 1024\n    const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"]\n    const i = Math.floor(Math.log(bytes) / Math.log(k))\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + \" \" + sizes[i]\n  }\n\n  return (\n    <div className={cn(\"w-full max-w-4xl\", className)}>\n      {/* Image Grid - Moved to top */}\n      <div className=\"mb-6\">\n        <div className=\"grid grid-cols-4 gap-2.5\">\n          {/* Always show all visible default images first */}\n          {visibleDefaultImages.map((defaultImg) => (\n            <Card\n              key={defaultImg.id}\n              className=\"bg-accent/50 group/item rounded-md relative flex shrink-0 items-center justify-center p-0 shadow-none\"\n            >\n              <img\n                src={defaultImg.src}\n                className=\"rounded-md h-[120px] w-full object-cover\"\n                alt={defaultImg.alt}\n              />\n\n              {/* Remove Button Overlay for default images too */}\n              <Button\n                onClick={() => removeImage(defaultImg.id)}\n                variant=\"outline\"\n                size=\"icon\"\n                className=\"absolute end-1 top-1 size-6 rounded-full opacity-0 shadow-sm group-hover/item:opacity-100 dark:bg-zinc-800 hover:dark:bg-zinc-700\"\n              >\n                <IconPlaceholder\n                  lucide=\"XIcon\"\n                  tabler=\"IconX\"\n                  hugeicons=\"MultiplicationSignIcon\"\n                  phosphor=\"XIcon\"\n                  remixicon=\"RiCloseLine\"\n                  className=\"size-3.5\"\n                />\n              </Button>\n            </Card>\n          ))}\n        </div>\n\n        {/* Show uploaded images in a separate grid below */}\n        {images.length > 0 && (\n          <div className=\"mt-4 grid grid-cols-4 gap-2.5\">\n            {images.map((imageFile, index) => (\n              <Card\n                key={imageFile.id}\n                className=\"bg-accent/50 group/item relative flex shrink-0 items-center justify-center rounded-md p-0 shadow-none\"\n              >\n                <img\n                  src={imageFile.preview}\n                  className=\"h-[120px] w-full rounded-md object-cover\"\n                  alt={`Product view ${index + 1}`}\n                />\n\n                {/* Remove Button Overlay */}\n                <Button\n                  onClick={() => removeImage(imageFile.id)}\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"absolute end-2 top-2 size-6 rounded-full opacity-0 shadow-sm group-hover/item:opacity-100 dark:bg-zinc-800 hover:dark:bg-zinc-700\"\n                >\n                  <IconPlaceholder\n                    lucide=\"XIcon\"\n                    tabler=\"IconX\"\n                    hugeicons=\"MultiplicationSignIcon\"\n                    phosphor=\"XIcon\"\n                    remixicon=\"RiCloseLine\"\n                    className=\"size-3.5\"\n                  />\n                </Button>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Upload Area */}\n      <Card\n        className={cn(\n          \"rounded-md border-dashed shadow-none transition-colors\",\n          isDragging\n            ? \"border-primary bg-primary/5\"\n            : \"border-muted-foreground/25 hover:border-muted-foreground/50\"\n        )}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n      >\n        <CardContent className=\"text-center\">\n          <div className=\"border-border mx-auto mb-3 flex size-[32px] items-center justify-center rounded-full border\">\n            <IconPlaceholder\n              lucide=\"CloudUploadIcon\"\n              tabler=\"IconCloudUpload\"\n              hugeicons=\"CloudUploadIcon\"\n              phosphor=\"CloudArrowUpIcon\"\n              remixicon=\"RiUploadCloud2Line\"\n              className=\"size-4\"\n            />\n          </div>\n          <h3 className=\"text-2sm text-foreground mb-0.5 font-semibold\">\n            Choose a file or drag & drop here.\n          </h3>\n          <span className=\"text-secondary-foreground mb-3 block text-xs font-normal\">\n            JPEG, PNG, up to {formatBytes(maxSize)}.\n          </span>\n          <Button size=\"sm\" onClick={openFileDialog}>\n            Browse File\n          </Button>\n        </CardContent>\n      </Card>\n\n      {/* Upload Progress Cards */}\n      {images.length > 0 && (\n        <div className=\"mt-6 space-y-3\">\n          {images.map((imageFile) => (\n            <Card\n              key={imageFile.id}\n              className=\"rounded-md p-0 shadow-none\"\n            >\n              <CardContent className=\"flex items-center gap-2 p-3\">\n                <div className=\"border-border rounded-md flex size-[32px] shrink-0 items-center justify-center border\">\n                  <IconPlaceholder\n                    lucide=\"ImageIcon\"\n                    tabler=\"IconPhoto\"\n                    hugeicons=\"ImageIcon\"\n                    phosphor=\"ImageIcon\"\n                    remixicon=\"RiImageLine\"\n                    className=\"text-muted-foreground size-4\"\n                  />\n                </div>\n                <div className=\"flex w-full flex-col gap-1.5\">\n                  <div className=\"-mt-2 flex w-full items-center justify-between gap-2.5\">\n                    <div className=\"flex items-center gap-2.5\">\n                      <span className=\"text-foreground text-xs leading-none font-medium\">\n                        {imageFile.file.name}\n                      </span>\n                      <span className=\"text-muted-foreground text-xs leading-none font-normal\">\n                        {formatBytes(imageFile.file.size)}\n                      </span>\n                      {imageFile.status === \"uploading\" && (\n                        <p className=\"text-muted-foreground text-xs\">\n                          Uploading... {Math.round(imageFile.progress)}%\n                        </p>\n                      )}\n                    </div>\n                    <Button\n                      onClick={() => removeImage(imageFile.id)}\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"size-6\"\n                    >\n                      <IconPlaceholder\n                        lucide=\"CircleXIcon\"\n                        tabler=\"IconCircleX\"\n                        hugeicons=\"CancelCircleIcon\"\n                        phosphor=\"XCircleIcon\"\n                        remixicon=\"RiCloseCircleLine\"\n                        className=\"size-3.5\"\n                      />\n                    </Button>\n                  </div>\n\n                  <Progress\n                    value={imageFile.progress}\n                    className={cn(\n                      \"h-1 transition-all duration-300\",\n                      \"[&>div]:bg-zinc-950 dark:[&>div]:bg-zinc-50\"\n                    )}\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n\n      {/* Error Messages */}\n      {errors.length > 0 && (\n        <Alert variant=\"destructive\" className=\"mt-5\">\n          <IconPlaceholder\n            lucide=\"CircleAlertIcon\"\n            tabler=\"IconAlertCircle\"\n            hugeicons=\"AlertCircleIcon\"\n            phosphor=\"WarningCircleIcon\"\n            remixicon=\"RiErrorWarningLine\"\n          />\n          <AlertTitle>File upload error(s)</AlertTitle>\n          <AlertDescription>\n            {errors.map((error, index) => (\n              <p key={index} className=\"last:mb-0\">\n                {error}\n              </p>\n            ))}\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  )\n}","target":"components/patterns/p-file-upload-7.tsx"}]}