{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"p-calendar-26","type":"registry:block","title":"Calendar with date picker and year view","description":"Calendar with date picker and year view","dependencies":["date-fns","react-day-picker"],"registryDependencies":["button","calendar","card","popover","scroll-area"],"files":[{"path":"p-calendar-26.tsx","type":"registry:block","content":"\"use client\"\n\nimport {\n  Dispatch,\n  HTMLAttributes,\n  ReactNode,\n  SetStateAction,\n  useEffect,\n  useId,\n  useRef,\n  useState,\n} from \"react\"\nimport {\n  eachMonthOfInterval,\n  eachYearOfInterval,\n  endOfYear,\n  format,\n  isAfter,\n  isBefore,\n  startOfYear,\n} from \"date-fns\"\nimport type { CaptionLabelProps, MonthGridProps } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport { Card, CardContent } from \"@/components/ui/card\"\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\"\nimport { ScrollArea } from \"@/components/ui/scroll-area\"\nimport { IconPlaceholder } from \"@/app/(create)/components/icon-placeholder\"\n\nexport function Pattern() {\n  const id = useId()\n  const today = new Date()\n  const [month, setMonth] = useState(today)\n  const [date, setDate] = useState<Date | undefined>(today)\n  const [isYearView, setIsYearView] = useState(false)\n  const [selectedYear, setSelectedYear] = useState<number | null>(null)\n\n  const startYear = today.getFullYear() - 10\n  const endYear = today.getFullYear() + 10\n  const startDate = startOfYear(new Date(startYear, 0))\n  const endDate = endOfYear(new Date(endYear, 11))\n\n  const years = eachYearOfInterval({\n    end: endOfYear(endDate),\n    start: startOfYear(startDate),\n  })\n\n  return (\n    <Popover>\n      <PopoverTrigger>\n        <Button\n          className=\"group/pick-date w-60 justify-between\"\n          id={id}\n          variant={\"outline\"}\n        >\n          <span className={cn(\"truncate\", date && \"text-muted-foreground\")}>\n            {date ? format(date, \"LLL dd, y\") : \"Pick a date\"}\n          </span>\n          <IconPlaceholder\n            lucide=\"CalendarIcon\"\n            tabler=\"IconCalendarEvent\"\n            hugeicons=\"Calendar04Icon\"\n            phosphor=\"CalendarBlankIcon\"\n            remixicon=\"RiCalendarLine\"\n            aria-hidden=\"true\"\n            className=\"text-muted-foreground/80 group-hover:text-foreground shrink-0 transition-colors\"\n          />\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent align=\"start\" className=\"w-auto p-0\">\n        <Card className=\"p-0\">\n          <CardContent className=\"p-0\">\n            <Calendar\n              classNames={{\n                month_caption: \"justify-start\",\n                nav: \"flex items-center w-full absolute inset-x-0 justify-end pointer-events-none [&>button]:pointer-events-auto\",\n              }}\n              components={{\n                CaptionLabel: (props: CaptionLabelProps) => (\n                  <CaptionLabel\n                    isYearView={isYearView}\n                    setIsYearView={(val) => {\n                      setIsYearView(val)\n                      if (!val) setSelectedYear(null)\n                    }}\n                    {...props}\n                  />\n                ),\n                MonthGrid: (props: MonthGridProps) => {\n                  return (\n                    <MonthGrid\n                      className={props.className}\n                      currentMonth={month.getMonth()}\n                      currentYear={month.getFullYear()}\n                      endDate={endDate}\n                      isYearView={isYearView}\n                      onMonthSelect={(selectedMonth: Date) => {\n                        setMonth(selectedMonth)\n                        setIsYearView(false)\n                        setSelectedYear(null)\n                      }}\n                      setIsYearView={setIsYearView}\n                      startDate={startDate}\n                      years={years}\n                      selectedYear={selectedYear}\n                      setSelectedYear={setSelectedYear}\n                    >\n                      {props.children}\n                    </MonthGrid>\n                  )\n                },\n              }}\n              defaultMonth={new Date()}\n              endMonth={endDate}\n              mode=\"single\"\n              month={month}\n              onMonthChange={setMonth}\n              onSelect={setDate}\n              selected={date}\n              startMonth={startDate}\n            />\n          </CardContent>\n        </Card>\n      </PopoverContent>\n    </Popover>\n  )\n}\n\nfunction MonthGrid({\n  className,\n  children,\n  isYearView,\n  years,\n  currentYear,\n  currentMonth,\n  onMonthSelect,\n  selectedYear,\n  setSelectedYear,\n  startDate,\n  endDate,\n}: {\n  className?: string\n  children: ReactNode\n  isYearView: boolean\n  setIsYearView: Dispatch<SetStateAction<boolean>>\n  startDate: Date\n  endDate: Date\n  years: Date[]\n  currentYear: number\n  currentMonth: number\n  onMonthSelect: (date: Date) => void\n  selectedYear: number | null\n  setSelectedYear: Dispatch<SetStateAction<number | null>>\n}) {\n  const scrollAreaRef = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    if (isYearView && scrollAreaRef.current) {\n      const activeElement = scrollAreaRef.current.querySelector(\n        \"[data-active='true']\"\n      ) as HTMLElement | null\n\n      if (activeElement) {\n        activeElement.scrollIntoView({ block: \"center\" })\n      }\n    }\n  }, [isYearView, selectedYear])\n\n  return (\n    <div className=\"relative\">\n      <table className={className}>{children}</table>\n      {isYearView && (\n        <div className=\"bg-background absolute inset-0 z-20 -m-2\">\n          <div className=\"h-full\" ref={scrollAreaRef}>\n            <ScrollArea className=\"h-full\">\n              <div className=\"px-3 pt-1 pb-3\">\n                {selectedYear === null ? (\n                  <div className=\"grid grid-cols-4 gap-2\">\n                    {years.map((year) => {\n                      const y = year.getFullYear()\n                      const isCurrent = y === currentYear\n                      return (\n                        <Button\n                          key={y}\n                          variant={isCurrent ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          className=\"h-8\"\n                          data-active={isCurrent}\n                          onClick={() => setSelectedYear(y)}\n                        >\n                          {y}\n                        </Button>\n                      )\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"flex flex-col gap-2\">\n                    <div className=\"flex items-center gap-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"px-2\"\n                        onClick={() => setSelectedYear(null)}\n                      >\n                        <IconPlaceholder\n                          lucide=\"ChevronDownIcon\"\n                          tabler=\"IconChevronDown\"\n                          hugeicons=\"ArrowDown01Icon\"\n                          phosphor=\"CaretDownIcon\"\n                          remixicon=\"RiArrowDownSLine\"\n                          className=\"mr-1 size-4 rotate-90\"\n                        />\n                        {selectedYear}\n                      </Button>\n                    </div>\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      {eachMonthOfInterval({\n                        start: startOfYear(new Date(selectedYear, 0)),\n                        end: endOfYear(new Date(selectedYear, 0)),\n                      }).map((month) => {\n                        const isCurrent =\n                          month.getMonth() === currentMonth &&\n                          selectedYear === currentYear\n\n                        const isDisabled =\n                          isBefore(month, startOfYear(startDate)) ||\n                          isAfter(month, endOfYear(endDate))\n\n                        return (\n                          <Button\n                            key={month.getTime()}\n                            variant={isCurrent ? \"default\" : \"outline\"}\n                            size=\"sm\"\n                            className=\"h-8\"\n                            data-active={isCurrent}\n                            disabled={isDisabled}\n                            onClick={() => onMonthSelect(month)}\n                          >\n                            {format(month, \"MMM\")}\n                          </Button>\n                        )\n                      })}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </ScrollArea>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nfunction CaptionLabel({\n  children,\n  isYearView,\n  setIsYearView,\n}: {\n  isYearView: boolean\n  setIsYearView: Dispatch<SetStateAction<boolean>>\n} & HTMLAttributes<HTMLSpanElement>) {\n  return (\n    <Button\n      className=\"data-[state=open]:text-muted-foreground/80 -ms-2 flex items-center gap-2 text-sm font-medium hover:bg-transparent [&[data-state=open]>svg]:rotate-180\"\n      data-state={isYearView ? \"open\" : \"closed\"}\n      onClick={() => setIsYearView((prev) => !prev)}\n      size=\"sm\"\n      variant=\"ghost\"\n    >\n      {children}\n      <IconPlaceholder\n        lucide=\"ChevronDownIcon\"\n        tabler=\"IconChevronDown\"\n        hugeicons=\"ArrowDown01Icon\"\n        phosphor=\"CaretDownIcon\"\n        remixicon=\"RiArrowDownSLine\"\n        aria-hidden=\"true\"\n        className=\"text-muted-foreground/80 shrink-0 transition-transform duration-200\"\n      />\n    </Button>\n  )\n}","target":"components/patterns/p-calendar-26.tsx"}]}