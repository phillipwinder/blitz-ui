{"$schema":"https://ui.shadcn.com/schema/registry-item.json","name":"p-file-upload-9","type":"registry:block","title":"Card file upload.","description":"Card file upload.","dependencies":[],"registryDependencies":["https://reui.io/r/styles/radix-maia/alert.json","button","tooltip","https://reui.io/r/styles/radix-maia/use-file-upload.json"],"files":[{"path":"p-file-upload-9.tsx","type":"registry:block","content":"\"use client\"\n\nimport { useEffect, useState } from \"react\"\nimport {\n  formatBytes,\n  useFileUpload,\n  type FileMetadata,\n  type FileWithPreview,\n} from \"@/hooks/use-file-upload\"\nimport {\n  Alert,\n  AlertDescription,\n  AlertTitle,\n} from \"@/components/reui/alert\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\nimport { IconPlaceholder } from \"@/app/(create)/components/icon-placeholder\"\n\n// Extend FileWithPreview to include upload status and progress\ninterface FileUploadItem extends FileWithPreview {\n  progress: number\n  status: \"uploading\" | \"completed\" | \"error\"\n  error?: string\n}\n\ninterface CardUploadProps {\n  maxFiles?: number\n  maxSize?: number\n  accept?: string\n  multiple?: boolean\n  className?: string\n  onFilesChange?: (files: FileUploadItem[]) => void\n  simulateUpload?: boolean\n}\n\nexport function Pattern({\n  maxFiles = 10,\n  maxSize = 50 * 1024 * 1024, // 50MB\n  accept = \"*\",\n  multiple = true,\n  className,\n  onFilesChange,\n  simulateUpload = true,\n}: CardUploadProps) {\n  // Create default files using FileMetadata type\n  const defaultFiles: FileMetadata[] = [\n    {\n      id: \"default-card-1\",\n      name: \"intro.zip\",\n      size: 252846,\n      type: \"application/zip\",\n      url: \"/media/files/intro.zip\",\n    },\n    {\n      id: \"default-card-2\",\n      name: \"image-01.jpg\",\n      size: 1536000,\n      type: \"image/jpeg\",\n      url: \"https://picsum.photos/1000/800?grayscale&random=3\",\n    },\n    {\n      id: \"default-card-3\",\n      name: \"audio.mp3\",\n      size: 1536000,\n      type: \"audio/mpeg\",\n      url: \"/media/files/audio.mp3\",\n    },\n  ]\n\n  // Convert default files to FileUploadItem format\n  const defaultUploadFiles: FileUploadItem[] = defaultFiles.map((file) => ({\n    id: file.id,\n    file: {\n      id: file.id,\n      name: file.name,\n      size: file.size,\n      type: file.type,\n    } as unknown as File,\n    preview: file.url,\n    progress: 100,\n    status: \"completed\" as const,\n  }))\n\n  const [uploadFiles, setUploadFiles] =\n    useState<FileUploadItem[]>(defaultUploadFiles)\n\n  const [\n    { isDragging, errors },\n    {\n      removeFile,\n      clearFiles,\n      handleDragEnter,\n      handleDragLeave,\n      handleDragOver,\n      handleDrop,\n      openFileDialog,\n      getInputProps,\n    },\n  ] = useFileUpload({\n    maxFiles,\n    maxSize,\n    accept,\n    multiple,\n    initialFiles: defaultFiles,\n    onFilesChange: (newFiles) => {\n      // Convert to upload items when files change, preserving existing status\n      const newUploadFiles = newFiles.map((file) => {\n        // Check if this file already exists in uploadFiles\n        const existingFile = uploadFiles.find(\n          (existing) => existing.id === file.id\n        )\n\n        if (existingFile) {\n          // Preserve existing file status and progress\n          return {\n            ...existingFile,\n            ...file, // Update any changed properties from the file\n          }\n        } else {\n          // New file - set to uploading\n          return {\n            ...file,\n            progress: 0,\n            status: \"uploading\" as const,\n          }\n        }\n      })\n\n      setUploadFiles(newUploadFiles)\n      onFilesChange?.(newUploadFiles)\n    },\n  })\n\n  // Simulate upload progress for new files\n  useEffect(() => {\n    if (!simulateUpload) return\n\n    const uploadingFiles = uploadFiles.filter(\n      (file) => file.status === \"uploading\"\n    )\n    if (uploadingFiles.length === 0) return\n\n    const interval = setInterval(() => {\n      setUploadFiles((prev) =>\n        prev.map((file) => {\n          if (file.status !== \"uploading\") return file\n\n          const increment = Math.random() * 20 + 5 // Random increment between 5-25%\n          const newProgress = Math.min(file.progress + increment, 100)\n\n          if (newProgress >= 100) {\n            // Simulate occasional failures (10% chance)\n            const shouldFail = Math.random() < 0.1\n            return {\n              ...file,\n              progress: 100,\n              status: shouldFail ? (\"error\" as const) : (\"completed\" as const),\n              error: shouldFail\n                ? \"Upload failed. Please try again.\"\n                : undefined,\n            }\n          }\n\n          return { ...file, progress: newProgress }\n        })\n      )\n    }, 500)\n\n    return () => clearInterval(interval)\n  }, [uploadFiles, simulateUpload])\n\n  const removeUploadFile = (fileId: string) => {\n    const fileToRemove = uploadFiles.find((f) => f.id === fileId)\n    if (fileToRemove) {\n      removeFile(fileToRemove.id)\n    }\n  }\n\n  const retryUpload = (fileId: string) => {\n    setUploadFiles((prev) =>\n      prev.map((file) =>\n        file.id === fileId\n          ? {\n              ...file,\n              progress: 0,\n              status: \"uploading\" as const,\n              error: undefined,\n            }\n          : file\n      )\n    )\n  }\n\n  const getFileIcon = (file: File | FileMetadata) => {\n    const type = file instanceof File ? file.type : file.type\n    if (type.startsWith(\"image/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"ImageIcon\"\n          tabler=\"IconPhoto\"\n          hugeicons=\"ImageIcon\"\n          phosphor=\"ImageIcon\"\n          remixicon=\"RiImageLine\"\n          className=\"text-muted-foreground size-4\"\n        />\n      )\n    if (type.startsWith(\"video/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"VideoIcon\"\n          tabler=\"IconVideo\"\n          hugeicons=\"Video02Icon\"\n          phosphor=\"VideoCameraIcon\"\n          remixicon=\"RiVideoOnLine\"\n        />\n      )\n    if (type.startsWith(\"audio/\"))\n      return (\n        <IconPlaceholder\n          lucide=\"HeadphonesIcon\"\n          tabler=\"IconHeadphones\"\n          hugeicons=\"HeadphonesIcon\"\n          phosphor=\"Headphones\"\n          remixicon=\"RiCustomerServiceLine\"\n          className=\"size-6\"\n        />\n      )\n    if (type.includes(\"pdf\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileTextIcon\"\n          tabler=\"IconFileText\"\n          hugeicons=\"File02Icon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-6\"\n        />\n      )\n    if (type.includes(\"word\") || type.includes(\"doc\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileTextIcon\"\n          tabler=\"IconFileText\"\n          hugeicons=\"File02Icon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-6\"\n        />\n      )\n    if (type.includes(\"excel\") || type.includes(\"sheet\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileSpreadsheetIcon\"\n          tabler=\"IconFileSpreadsheet\"\n          hugeicons=\"GoogleSheetIcon\"\n          phosphor=\"FileTextIcon\"\n          remixicon=\"RiFileTextLine\"\n          className=\"size-6\"\n        />\n      )\n    if (type.includes(\"zip\") || type.includes(\"rar\"))\n      return (\n        <IconPlaceholder\n          lucide=\"FileArchiveIcon\"\n          tabler=\"IconFileZip\"\n          hugeicons=\"ArchiveIcon\"\n          phosphor=\"FileArchive\"\n          remixicon=\"RiFileZipLine\"\n          className=\"size-6\"\n        />\n      )\n    return (\n      <IconPlaceholder\n        lucide=\"FileTextIcon\"\n        tabler=\"IconFileText\"\n        hugeicons=\"File02Icon\"\n        phosphor=\"FileTextIcon\"\n        remixicon=\"RiFileTextLine\"\n      />\n    )\n  }\n\n  return (\n    <div className={cn(\"w-full space-y-4\", className)}>\n      {/* Upload Area */}\n      <div\n        className={cn(\n          \"rounded-lg relative border border-dashed p-6 text-center transition-colors\",\n          isDragging\n            ? \"border-primary bg-primary/5\"\n            : \"border-muted-foreground/25 hover:border-muted-foreground/50\"\n        )}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n      >\n        <input {...getInputProps()} className=\"sr-only\" />\n\n        <div className=\"flex flex-col items-center gap-4\">\n          <div\n            className={cn(\n              \"bg-muted flex h-12 w-12 items-center justify-center rounded-full transition-colors\",\n              isDragging\n                ? \"border-primary bg-primary/10\"\n                : \"border-muted-foreground/25\"\n            )}\n          >\n            <IconPlaceholder\n              lucide=\"UploadIcon\"\n              tabler=\"IconUpload\"\n              hugeicons=\"Upload01Icon\"\n              phosphor=\"UploadSimple\"\n              remixicon=\"RiUpload2Line\"\n              className=\"text-muted-foreground h-5 w-5\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <p className=\"text-sm font-medium\">\n              Drop files here or{\" \"}\n              <button\n                type=\"button\"\n                onClick={openFileDialog}\n                className=\"text-primary cursor-pointer underline-offset-4 hover:underline\"\n              >\n                browse files\n              </button>\n            </p>\n            <p className=\"text-muted-foreground text-xs\">\n              Maximum file size: {formatBytes(maxSize)} â€¢ Maximum files:{\" \"}\n              {maxFiles}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Files Grid */}\n      {uploadFiles.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"text-sm font-medium\">\n              Files ({uploadFiles.length})\n            </h3>\n            <div className=\"flex gap-2\">\n              <Button onClick={openFileDialog} variant=\"outline\" size=\"sm\">\n                <IconPlaceholder\n                  lucide=\"CloudUploadIcon\"\n                  tabler=\"IconCloudUpload\"\n                  hugeicons=\"CloudUploadIcon\"\n                  phosphor=\"CloudArrowUpIcon\"\n                  remixicon=\"RiUploadCloud2Line\"\n                />\n                Add files\n              </Button>\n              <Button onClick={clearFiles} variant=\"outline\" size=\"sm\">\n                <IconPlaceholder\n                  lucide=\"Trash2Icon\"\n                  tabler=\"IconTrash\"\n                  hugeicons=\"Delete02Icon\"\n                  phosphor=\"TrashIcon\"\n                  remixicon=\"RiDeleteBinLine\"\n                />\n                Remove all\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 gap-4 sm:grid-cols-4 lg:grid-cols-6\">\n            {uploadFiles.map((fileItem) => (\n              <div key={fileItem.id} className=\"group/item relative\">\n                {/* Remove button */}\n                <Button\n                  onClick={() => removeUploadFile(fileItem.id)}\n                  variant=\"outline\"\n                  size=\"icon\"\n                  className=\"absolute -end-2 -top-2 z-10 size-6 rounded-full opacity-0 transition-opacity group-hover/item:opacity-100 dark:bg-zinc-800 hover:dark:bg-zinc-700\"\n                >\n                  <IconPlaceholder\n                    lucide=\"XIcon\"\n                    tabler=\"IconX\"\n                    hugeicons=\"MultiplicationSignIcon\"\n                    phosphor=\"XIcon\"\n                    remixicon=\"RiCloseLine\"\n                    className=\"size-3.5\"\n                  />\n                </Button>\n\n                {/* Wrapper */}\n                <div className=\"bg-card rounded-lg relative overflow-hidden border transition-colors\">\n                  {/* Image preview or file icon area */}\n                  <div className=\"bg-muted border-border relative aspect-square border-b\">\n                    {fileItem.file.type.startsWith(\"image/\") &&\n                    fileItem.preview ? (\n                      <>\n                        {/* Image cover */}\n                        <img\n                          src={fileItem.preview}\n                          alt={fileItem.file.name}\n                          className=\"h-full w-full object-cover\"\n                        />\n                        {/* Progress overlay for uploading images */}\n                        {fileItem.status === \"uploading\" && (\n                          <div className=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n                            <div className=\"relative\">\n                              <svg\n                                className=\"size-12 -rotate-90\"\n                                viewBox=\"0 0 48 48\"\n                              >\n                                <circle\n                                  cx=\"24\"\n                                  cy=\"24\"\n                                  r=\"20\"\n                                  fill=\"none\"\n                                  stroke=\"currentColor\"\n                                  strokeWidth=\"3\"\n                                  className=\"text-muted/60\"\n                                />\n                                <circle\n                                  cx=\"24\"\n                                  cy=\"24\"\n                                  r=\"20\"\n                                  fill=\"none\"\n                                  stroke=\"currentColor\"\n                                  strokeWidth=\"3\"\n                                  strokeDasharray={`${2 * Math.PI * 20}`}\n                                  strokeDashoffset={`${2 * Math.PI * 20 * (1 - fileItem.progress / 100)}`}\n                                  className=\"text-white transition-all duration-300\"\n                                  strokeLinecap=\"round\"\n                                />\n                              </svg>\n                            </div>\n                          </div>\n                        )}\n                      </>\n                    ) : (\n                      /* File icon area for non-images */\n                      <div className=\"text-muted-foreground/80 flex h-full items-center justify-center\">\n                        {fileItem.status === \"uploading\" ? (\n                          <div className=\"relative\">\n                            <svg\n                              className=\"size-12 -rotate-90\"\n                              viewBox=\"0 0 48 48\"\n                            >\n                              <circle\n                                cx=\"24\"\n                                cy=\"24\"\n                                r=\"20\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"3\"\n                                className=\"text-muted-foreground/20\"\n                              />\n                              <circle\n                                cx=\"24\"\n                                cy=\"24\"\n                                r=\"20\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                strokeWidth=\"3\"\n                                strokeDasharray={`${2 * Math.PI * 20}`}\n                                strokeDashoffset={`${2 * Math.PI * 20 * (1 - fileItem.progress / 100)}`}\n                                className=\"text-primary transition-all duration-300\"\n                                strokeLinecap=\"round\"\n                              />\n                            </svg>\n                            <div className=\"absolute inset-0 flex items-center justify-center\">\n                              {getFileIcon(fileItem.file)}\n                            </div>\n                          </div>\n                        ) : (\n                          <div className=\"text-4xl\">\n                            {getFileIcon(fileItem.file)}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n\n                  {/* File info footer */}\n                  <div className=\"p-3\">\n                    <div className=\"space-y-1\">\n                      <p className=\"truncate text-sm font-medium\">\n                        {fileItem.file.name}\n                      </p>\n                      <div className=\"relative flex items-center justify-between gap-2\">\n                        <span className=\"text-muted-foreground text-xs\">\n                          {formatBytes(fileItem.file.size)}\n                        </span>\n\n                        {fileItem.status === \"error\" && fileItem.error && (\n                          <TooltipProvider>\n                            <Tooltip>\n                              <TooltipTrigger asChild>\n                                <Button\n                                  onClick={() => retryUpload(fileItem.id)}\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"text-destructive hover:bg-destructive/10 hover:text-destructive absolute end-0 -top-1.25 size-6\"\n                                >\n                                  <IconPlaceholder\n                                    lucide=\"RefreshCwIcon\"\n                                    tabler=\"IconRefreshDot\"\n                                    hugeicons=\"Refresh04Icon\"\n                                    phosphor=\"ArrowsClockwiseIcon\"\n                                    remixicon=\"RiRestartLine\"\n                                    className=\"size-3 opacity-100\"\n                                  />\n                                </Button>\n                              </TooltipTrigger>\n                              <TooltipContent>\n                                Upload failed. Retry\n                              </TooltipContent>\n                            </Tooltip>\n                          </TooltipProvider>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Error Messages */}\n      {errors.length > 0 && (\n        <Alert variant=\"destructive\" className=\"mt-5\">\n          <IconPlaceholder\n            lucide=\"CircleAlertIcon\"\n            tabler=\"IconAlertCircle\"\n            hugeicons=\"AlertCircleIcon\"\n            phosphor=\"WarningCircleIcon\"\n            remixicon=\"RiErrorWarningLine\"\n          />\n          <AlertTitle>File upload error(s)</AlertTitle>\n          <AlertDescription>\n            {errors.map((error, index) => (\n              <p key={index} className=\"last:mb-0\">\n                {error}\n              </p>\n            ))}\n          </AlertDescription>\n        </Alert>\n      )}\n    </div>\n  )\n}","target":"components/patterns/p-file-upload-9.tsx"}]}